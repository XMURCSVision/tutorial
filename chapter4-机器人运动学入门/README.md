# 机器人运动学入门

这部分内容参考《视觉SLAM十四讲：从理论到实践》（第3讲 三维空间刚体运动）和[fishros动手学ROS2教程](https://fishros.com/d2lros2/#/humble/chapt6/get_started/1.%E7%A9%BA%E9%97%B4%E5%9D%90%E6%A0%87%E6%8F%8F%E8%BF%B0)

## 旋转矩阵

### 点、向量和坐标系

点就是空间中的基本元素，没有长度、体积。把两个点连接起来，就构成了向量。向量可以看成从某点指向另一点的一个箭头。请不要把向量与它的坐标这两个概念混淆。一个向量是空间当中的一样东西，比如$\vec{\alpha}$，这里的$\vec{\alpha}$并不需要和若干个实数相关联。只有当我们指定这个三维空间中的某个坐标系时，才可以谈论该向量在此坐标系下的坐标。

向量与向量、向量与数之间的运算，例如数乘、加法、减法、内积、外积等。

### 坐标系间的欧式变换

两个坐标系之间的运动由一个旋转加上一个平移组成，这种运动称为刚体运动。我们经常在实际场景中定义各种各样的坐标系。在机器人学中，我们会给每一个连杆和关节定义它们的坐标系；在3D作图时，我们也会定义每一个长方体、圆柱体的坐标系。如果考虑运动的机器人，那么常见的做法是设定一个惯性坐标系（或者叫世界坐标系），可以认为它是固定不动的。同时，相机或机器人是一个移动坐标系。相机运动就是一个刚体运动。刚体运动过程中，同一个向量在各个坐标系下的长度和夹角都不会发生改变。想象你把手机抛到空中，在它落地摔碎之前，只可能有空间位置和姿态的不同，而它的长度、各个面的角度等性质不会有任何变化。此时，我们说手机坐标系到世界坐标系之间，相差了一个**欧式变换**

欧式变换由旋转和平移组成。我们首先考虑旋转。设某个单位正交基$(e_1, e_2, e_3)$经过一次旋转变成了$(e_1', e_2', e_3')$。那么对于同一个向量$\vec{a}$（该向量并没有随着坐标系的旋转而发生运动），它在两个坐标系下的坐标为$[a_1, a_2, a_3]^T$和$[a_1', a_2', a_3']^T$。因为向量本身没有改变，所以有：
$$
\begin{bmatrix} e_1, e_2, e_3 \end{bmatrix} \begin{bmatrix} a_1 \\ a_2 \\ a_3 \end{bmatrix} = \begin{bmatrix} e_1', e_2', e_3' \end{bmatrix} \begin{bmatrix} a_1' \\ a_2' \\ a_3' \end{bmatrix}
$$

为了描述两个坐标之间的关系，我们对上述等式的左右两边同时左乘$\begin{bmatrix} e_1^T \\ e_2^T \\ e_3^T \end{bmatrix}$，那么左边的系数就变成了单位矩阵，所以：
$$
\begin{bmatrix} a_1 \\ a_2 \\ a_3 \end{bmatrix} = \begin{bmatrix} e_1^Te_1' & e_1^Te_2' & e_1^Te_3' \\ e_2^Te_1' & e_2^Te_2' & e_2^Te_3' \\ e_3^Te_1' & e_3^Te_2' & e_3^Te_3' \end{bmatrix} \begin{bmatrix} a_1' \\ a_2' \\ a_3' \end{bmatrix} \overset{\text{def}}{=} \mathbf{Ra'}
$$

我们把中间的矩阵拿出来，定义成一个矩阵$\mathbf{R}$。这个矩阵由两组基之间的内积组成，刻画了旋转前后同一个向量的坐标关系。因此，称为旋转矩阵。同时，该矩阵各分量是两个坐标系基的内积，由于基向量的长度为1，所以实际上是各基向量夹角的余弦值，所以也叫方向余弦矩阵。

相比于旋转，平移只需要将平移向量加到旋转之后的坐标上，非常简单。我们用一个旋转矩阵$\mathbf{R}$和一个平移向量$\mathbf{t}$完整地描述一个欧式空间的坐标变换关系。实际当中，我们会定义坐标系1、坐标系2，那么向量$\mathbf{a}$在两个坐标系下的坐标为$\mathbf{a_1}$，$\mathbf{a_2}$，它们之间的关系应该是：
$$
\mathbf{a_1} = \mathbf{Ra_2} + \mathbf{t}
$$

### 变换矩阵与齐次坐标

使用上述形式进行多次变换会显得很啰嗦，于是，我们引入齐次坐标和变换矩阵。在一个三维向量的末尾添加1，将其变成了四维向量，称为齐次坐标。对于这个四维向量，我们可以把旋转和平移写在一个矩阵里，使得整个关系变成线性关系，该矩阵称为变换矩阵。
$$
\begin{bmatrix} \mathbf{a'} \\ 1 \end{bmatrix} = \begin{bmatrix} \mathbf{R} & \mathbf{t} \\ \mathbf{0^T} & 1 \end{bmatrix} \begin{bmatrix} \mathbf{a} \\ 1 \end{bmatrix} \overset{\text{def}}{=} \mathbf{T} \begin{bmatrix} \mathbf{a} \\ 1 \end{bmatrix}
$$

## 旋转向量和欧拉角

旋转矩阵存在两个缺点：
- 3个自由度用了9个量表示，这种表达方式是冗余的。
- 带有约束：必须是一个正交矩阵，且行列式为1。

事实上，任意旋转都可以用一个旋转轴和一个旋转角来刻画。于是，我们可以使用一个向量，其方向与旋转轴一致，而长度等于旋转角。这样的向量称为旋转向量，只需要一个三维向量即可描述旋转。

无论是旋转矩阵还是旋转向量，对我们来说都不是非常直观。当我们看到它们的时候，很难想象出这个旋转究竟是什么样的。因此，我们使用另外一种非常直观的方式来描述旋转——欧拉角，它使用了3个分离的转角，把一个旋转分解成3次绕不同轴的旋转。分解方式包含12种旋转顺序和两种参考系（固定轴、不固定轴）。欧拉角通常用“偏航-俯仰-滚转”（yaw-pitch-row）3个角度来描述旋转。
- 绕物体的Z轴旋转，得到偏航角yaw
- 绕物体的Y轴旋转，得到俯仰角pitch
- 绕物体的X轴旋转，得到滚转角raw

欧拉角的一个重大缺点是会碰到著名的万向锁问题：在俯仰角为±90°时，第一次旋转与第三次旋转将使用同一个轴，使得系统丢失了一个自由度。这被称为奇异性问题。理论上可以证明，只要想用3个实数来表达三维旋转，都会不可避免地碰到奇异性问题。这有点类似于用经纬度表示地球表面坐标，在纬度为±90°时经度无意义。因此，欧拉角不适用于插值和迭代，往往只用于人机交互中。

## 四元数

旋转矩阵具有冗余性，而旋转向量和欧拉角具有奇异性。回想到复平面上向量的旋转，类似地，在表达三维旋转时，也有一种类似于复数的代数：四元数。它既紧凑，也没有奇异性。唯一的缺点就是不够直观，运算稍复杂些。

